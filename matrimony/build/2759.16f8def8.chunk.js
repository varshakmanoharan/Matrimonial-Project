"use strict";(self.webpackChunkmatrimony=self.webpackChunkmatrimony||[]).push([[2759],{72759:(Ce,S,s)=>{s.r(S),s.d(S,{ProvidersPage:()=>Q,default:()=>fe});var e=s(92132),y=s(21272),G=s(7441),Z=s(7537),ee=s(61485),se=s(99248),te=s(6239),ae=s(83997),ie=s(90151),re=s(68074),ne=s(67030),F=s(85963),de=s(42455),oe=s(38413),le=s(55356),ue=s(4198),ce=s(35513),_e=s(26127),z=s(90361),h=s(33363),b=s(85829),ge=s(98765),me=s(25641),Ee=s(88353),r=s(89167),pe=s(41909),Pe=s(39404),x=s(54894),C=s(74930),he=s(37679),ve=s(60043),Me=s(61535),t=s(33544),n=s(88724),Re=s(77965),a=s(12083);const R=({description:o,disabled:v,intlLabel:E,error:_,name:c,onChange:M,placeholder:d,providerToEditName:p,type:m,value:u})=>{const{formatMessage:l}=(0,x.A)(),P=c==="noName"?`${window.strapi.backendURL}/api/connect/${p}/callback`:u,f=l({id:E.id,defaultMessage:E.defaultMessage},{provider:p,...E.values}),g=o?l({id:o.id,defaultMessage:o.defaultMessage},{provider:p,...o.values}):"";if(m==="bool")return(0,e.jsx)(G.l,{"aria-label":c,checked:u,disabled:v,hint:g,label:f,name:c,offLabel:l({id:"app.components.ToggleCheckbox.off-label",defaultMessage:"Off"}),onLabel:l({id:"app.components.ToggleCheckbox.on-label",defaultMessage:"On"}),onChange:D=>{M({target:{name:c,value:D.target.checked}})}});const B=d?l({id:d.id,defaultMessage:d.defaultMessage},{...d.values}):"",W=_?l({id:_,defaultMessage:_}):"";return(0,e.jsx)(Z.k,{"aria-label":c,disabled:v,error:W,label:f,name:c,onChange:M,placeholder:B,type:m,value:P})};R.defaultProps={description:null,disabled:!1,error:"",placeholder:null,value:""},R.propTypes={description:t.shape({id:t.string.isRequired,defaultMessage:t.string.isRequired,values:t.object}),disabled:t.bool,error:t.string,intlLabel:t.shape({id:t.string.isRequired,defaultMessage:t.string.isRequired,values:t.object}).isRequired,name:t.string.isRequired,onChange:t.func.isRequired,placeholder:t.shape({id:t.string.isRequired,defaultMessage:t.string.isRequired,values:t.object}),providerToEditName:t.string.isRequired,type:t.string.isRequired,value:t.oneOfType([t.bool,t.string])};const T=({headerBreadcrumbs:o,initialData:v,isSubmiting:E,layout:_,isOpen:c,onSubmit:M,onToggle:d,providerToEditName:p})=>{const{formatMessage:m}=(0,x.A)();return c?(0,e.jsxs)(ee.k,{onClose:d,labelledBy:"title",children:[(0,e.jsx)(se.r,{children:(0,e.jsx)(he.B,{label:o.join(", "),children:o.map((u,l,P)=>(0,e.jsx)(ve.m,{isCurrent:l===P.length-1,children:u},u))})}),(0,e.jsx)(Me.Formik,{onSubmit:u=>M(u),initialValues:v,validationSchema:_.schema,validateOnChange:!1,children:({errors:u,handleChange:l,values:P})=>(0,e.jsxs)(r.Form,{children:[(0,e.jsx)(te.c,{children:(0,e.jsx)(ae.s,{direction:"column",alignItems:"stretch",gap:1,children:(0,e.jsx)(ie.x,{gap:5,children:_.form.map(f=>f.map(g=>(0,e.jsx)(re.E,{col:g.size,xs:12,children:(0,e.jsx)(R,{...g,error:u[g.name],onChange:l,value:P[g.name],providerToEditName:p})},g.name)))})})}),(0,e.jsx)(ne.j,{startActions:(0,e.jsx)(F.$,{variant:"tertiary",onClick:d,type:"button",children:m({id:"app.components.Button.cancel",defaultMessage:"Cancel"})}),endActions:(0,e.jsx)(F.$,{type:"submit",loading:E,children:m({id:"global.save",defaultMessage:"Save"})})})]})})]}):null};T.defaultProps={initialData:null,providerToEditName:null},T.propTypes={headerBreadcrumbs:t.arrayOf(t.string).isRequired,initialData:t.object,layout:t.shape({form:t.arrayOf(t.array),schema:t.object}).isRequired,isOpen:t.bool.isRequired,isSubmiting:t.bool.isRequired,onSubmit:t.func.isRequired,onToggle:t.func.isRequired,providerToEditName:t.string};const N={id:(0,n.g)("PopUpForm.Providers.redirectURL.front-end.label"),defaultMessage:"The redirect URL to your front-end app"},q={id:"http://www.client-app.com",defaultMessage:"http://www.client-app.com"},U={id:(0,n.g)("PopUpForm.Providers.enabled.description"),defaultMessage:"If disabled, users won't be able to use this provider."},A={id:(0,n.g)("PopUpForm.Providers.enabled.label"),defaultMessage:"Enable"},k={id:(0,n.g)("PopUpForm.Providers.key.label"),defaultMessage:"Client ID"},$={id:(0,n.g)("PopUpForm.Providers.redirectURL.label"),defaultMessage:"The redirect URL to add in your {provider} application configurations"},O={id:(0,n.g)("PopUpForm.Providers.key.placeholder"),defaultMessage:"TEXT"},H={id:(0,n.g)("PopUpForm.Providers.secret.label"),defaultMessage:"Client Secret"},I={email:{form:[[{intlLabel:A,name:"enabled",type:"bool",description:U,size:6}]],schema:a.Ik().shape({enabled:a.lc().required(r.translatedErrors.required)})},providers:{form:[[{intlLabel:A,name:"enabled",type:"bool",description:U,size:6,validations:{required:!0}}],[{intlLabel:k,name:"key",type:"text",placeholder:O,size:12,validations:{required:!0}}],[{intlLabel:H,name:"secret",type:"text",placeholder:O,size:12,validations:{required:!0}}],[{intlLabel:N,placeholder:q,name:"callback",type:"text",size:12,validations:{required:!0}}],[{intlLabel:$,name:"noName",type:"text",validations:{},size:12,disabled:!0}]],schema:a.Ik().shape({enabled:a.lc().required(r.translatedErrors.required),key:a.Yj().when("enabled",{is:!0,then:a.Yj().required(r.translatedErrors.required),otherwise:a.Yj()}),secret:a.Yj().when("enabled",{is:!0,then:a.Yj().required(r.translatedErrors.required),otherwise:a.Yj()}),callback:a.Yj().when("enabled",{is:!0,then:a.Yj().required(r.translatedErrors.required),otherwise:a.Yj()})})},providersWithSubdomain:{form:[[{intlLabel:A,name:"enabled",type:"bool",description:U,size:6,validations:{required:!0}}],[{intlLabel:k,name:"key",type:"text",placeholder:O,size:12,validations:{required:!0}}],[{intlLabel:H,name:"secret",type:"text",placeholder:O,size:12,validations:{required:!0}}],[{intlLabel:{id:(0,n.g)({id:"PopUpForm.Providers.jwksurl.label"}),defaultMessage:"JWKS URL"},name:"jwksurl",type:"text",placeholder:O,size:12,validations:{required:!1}}],[{intlLabel:{id:(0,n.g)("PopUpForm.Providers.subdomain.label"),defaultMessage:"Host URI (Subdomain)"},name:"subdomain",type:"text",placeholder:{id:(0,n.g)("PopUpForm.Providers.subdomain.placeholder"),defaultMessage:"my.subdomain.com"},size:12,validations:{required:!0}}],[{intlLabel:N,placeholder:q,name:"callback",type:"text",size:12,validations:{required:!0}}],[{intlLabel:$,name:"noName",type:"text",validations:{},size:12,disabled:!0}]],schema:a.Ik().shape({enabled:a.lc().required(r.translatedErrors.required),key:a.Yj().when("enabled",{is:!0,then:a.Yj().required(r.translatedErrors.required),otherwise:a.Yj()}),secret:a.Yj().when("enabled",{is:!0,then:a.Yj().required(r.translatedErrors.required),otherwise:a.Yj()}),subdomain:a.Yj().when("enabled",{is:!0,then:a.Yj().required(r.translatedErrors.required),otherwise:a.Yj()}),callback:a.Yj().when("enabled",{is:!0,then:a.Yj().required(r.translatedErrors.required),otherwise:a.Yj()})})}},Q=()=>{const{formatMessage:o,locale:v}=(0,x.A)(),E=(0,C.useQueryClient)(),{trackUsage:_}=(0,r.useTracking)(),[c,M]=y.useState(!1),[d,p]=y.useState(null),m=(0,r.useNotification)(),{lockApp:u,unlockApp:l}=(0,r.useOverlayBlocker)(),{get:P,put:f}=(0,r.useFetchClient)(),{formatAPIError:g}=(0,r.useAPIErrorHandler)(),B=(0,r.useCollator)(v,{sensitivity:"base"});(0,r.useFocusWhenNavigate)();const{isLoading:W,allowedActions:{canUpdate:D}}=(0,r.useRBAC)({update:n.P.updateProviders}),{isLoading:be,data:K}=(0,C.useQuery)(["users-permissions","get-providers"],async()=>{const{data:i}=await P("/users-permissions/providers");return i},{initialData:{}}),V=(0,C.useMutation)(i=>f("/users-permissions/providers",i),{async onSuccess(){await E.invalidateQueries(["users-permissions","providers"]),m({type:"success",message:{id:(0,n.g)("notification.success.submit")}}),_("didEditAuthenticationProvider"),Y(),l()},onError(i){m({type:"warning",message:g(i)}),l()},refetchActive:!1}),L=Object.entries(K).reduce((i,[j,ye])=>{const{icon:w,enabled:Le,subdomain:xe}=ye;return i.push({name:j,icon:w==="envelope"?["fas","envelope"]:["fab",w],enabled:Le,subdomain:xe}),i},[]).sort((i,j)=>B.compare(i.name,j.name)),Oe=be||W,X=y.useMemo(()=>d?!!L.find(j=>j.name===d)?.subdomain:!1,[L,d]),De=y.useMemo(()=>d==="email"?I.email:X?I.providersWithSubdomain:I.providers,[d,X]),Y=()=>{M(i=>!i)},J=i=>{D&&(p(i.name),Y())},je=async i=>{u(),_("willEditAuthenticationProvider"),V.mutate({providers:{...K,[d]:i}})};return(0,e.jsxs)(de.P,{children:[(0,e.jsx)(r.SettingsPageTitle,{name:o({id:(0,n.g)("HeaderNav.link.providers"),defaultMessage:"Providers"})}),(0,e.jsxs)(oe.g,{children:[(0,e.jsx)(le.Q,{title:o({id:(0,n.g)("HeaderNav.link.providers"),defaultMessage:"Providers"})}),Oe?(0,e.jsx)(r.LoadingIndicatorPage,{}):(0,e.jsx)(ue.s,{children:(0,e.jsxs)(ce.X,{colCount:3,rowCount:L.length+1,children:[(0,e.jsx)(_e.d,{children:(0,e.jsxs)(z.Tr,{children:[(0,e.jsx)(h.Th,{children:(0,e.jsx)(b.o,{variant:"sigma",textColor:"neutral600",children:o({id:"global.name",defaultMessage:"Name"})})}),(0,e.jsx)(h.Th,{children:(0,e.jsx)(b.o,{variant:"sigma",textColor:"neutral600",children:o({id:(0,n.g)("Providers.status"),defaultMessage:"Status"})})}),(0,e.jsx)(h.Th,{children:(0,e.jsx)(b.o,{variant:"sigma",children:(0,e.jsx)(ge.s,{children:o({id:"global.settings",defaultMessage:"Settings"})})})})]})}),(0,e.jsx)(me.N,{children:L.map(i=>(0,e.jsxs)(z.Tr,{...(0,r.onRowClick)({fn:()=>J(i),condition:D}),children:[(0,e.jsx)(h.Td,{width:"45%",children:(0,e.jsx)(b.o,{fontWeight:"semiBold",textColor:"neutral800",children:i.name})}),(0,e.jsx)(h.Td,{width:"65%",children:(0,e.jsx)(b.o,{textColor:i.enabled?"success600":"danger600","data-testid":`enable-${i.name}`,children:i.enabled?o({id:"global.enabled",defaultMessage:"Enabled"}):o({id:"global.disabled",defaultMessage:"Disabled"})})}),(0,e.jsx)(h.Td,{...r.stopPropagation,children:D&&(0,e.jsx)(Ee.K,{onClick:()=>J(i),noBorder:!0,icon:(0,e.jsx)(pe.A,{}),label:"Edit"})})]},i.name))})]})})]}),(0,e.jsx)(T,{initialData:K[d],isOpen:c,isSubmiting:V.isLoading,layout:De,headerBreadcrumbs:[o({id:(0,n.g)("PopUpForm.header.edit.providers"),defaultMessage:"Edit Provider"}),Pe(d)],onToggle:Y,onSubmit:je,providerToEditName:d})]})},fe=()=>(0,e.jsx)(r.CheckPagePermissions,{permissions:n.P.readProviders,children:(0,e.jsx)(Q,{})})}}]);
