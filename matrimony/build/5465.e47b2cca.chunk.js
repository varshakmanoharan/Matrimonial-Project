(self.webpackChunkmatrimony=self.webpackChunkmatrimony||[]).push([[5465],{87826:(E,j)=>{"use strict";Object.defineProperty(j,"__esModule",{value:!0}),j.default=l;function l(e,o){if(e==null)throw new TypeError("assign requires that input parameter not be null or undefined");for(var D in o)Object.prototype.hasOwnProperty.call(o,D)&&(e[D]=o[D]);return e}E.exports=j.default},21871:(E,j,l)=>{"use strict";var e=l(90448).default;Object.defineProperty(j,"__esModule",{value:!0}),j.default=D;var o=e(l(87826));function D(_){return(0,o.default)({},_)}E.exports=j.default},18724:(E,j)=>{"use strict";Object.defineProperty(j,"__esModule",{value:!0}),j.default=l;function l(e){var o=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return o.setUTCFullYear(e.getFullYear()),e.getTime()-o.getTime()}E.exports=j.default},34316:(E,j)=>{"use strict";Object.defineProperty(j,"__esModule",{value:!0}),j.default=l;function l(e){if(e===null||e===!0||e===!1)return NaN;var o=Number(e);return isNaN(o)?o:o<0?Math.ceil(o):Math.floor(o)}E.exports=j.default},90448:E=>{function j(l){return l&&l.__esModule?l:{default:l}}E.exports=j,E.exports.__esModule=!0,E.exports.default=E.exports},5465:(E,j,l)=>{"use strict";l.d(j,{App:()=>qt});var e=l(92132),o=l(89167),D=l(17703),_=l(71389),g=l(76607),F=l(21272),me=l(40427),Ue=l(61485),He=l(99248),y=l(85829),Be=l(6239),v=l(83997),Fe=l(7537),k=l(94061),We=l(4181),Ze=l(49451),Ge=l(69533),Qe=l(67030),J=l(85963),Ke=l(76517),Je=l(80782),Xe=l(53563),ke=l(90151),Ve=l(68074),ee=l(10573),qe=l(20636),V=l(38413),pe=l(55356),Q=l(4198),_e=l(12081),te=l(12408),et=l(48653),ae=l(24093),se=l(58805),tt=l(79739),at=l(64871),st=l(88353),xe=l(48323),nt=l(90361),K=l(33363),ve=l(21610),q=l(44876),rt=l(49654),it=l(36481),lt=l(5194),ot=l(41909),dt=l(50612),ct=l(49310),je=l(85166),ut=l(46270),gt=l(85641),ye=l(6103),ft=l(21871),ht=l(34316),De=l(18724);function mt(t,a){var s=jt(a);return s.formatToParts?xt(s,t):vt(s,t)}var pt={year:0,month:1,day:2,hour:3,minute:4,second:5};function xt(t,a){try{for(var s=t.formatToParts(a),n=[],r=0;r<s.length;r++){var i=pt[s[r].type];i>=0&&(n[i]=parseInt(s[r].value,10))}return n}catch(d){if(d instanceof RangeError)return[NaN];throw d}}function vt(t,a){var s=t.format(a).replace(/\u200E/g,""),n=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(s);return[n[3],n[1],n[2],n[4],n[5],n[6]]}var ne={};function jt(t){if(!ne[t]){var a=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:"America/New_York",year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date("2014-06-25T04:00:00.123Z")),s=a==="06/25/2014, 00:00:00"||a==="\u200E06\u200E/\u200E25\u200E/\u200E2014\u200E \u200E00\u200E:\u200E00\u200E:\u200E00";ne[t]=s?new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:t,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}return ne[t]}function re(t,a,s,n,r,i,d){var u=new Date(0);return u.setUTCFullYear(t,a,s),u.setUTCHours(n,r,i,d),u}var be=36e5,yt=6e4,ie={timezone:/([Z+-].*)$/,timezoneZ:/^(Z)$/,timezoneHH:/^([+-]\d{2})$/,timezoneHHMM:/^([+-]\d{2}):?(\d{2})$/};function le(t,a,s){var n,r;if(!t||(n=ie.timezoneZ.exec(t),n))return 0;var i;if(n=ie.timezoneHH.exec(t),n)return i=parseInt(n[1],10),Te(i)?-(i*be):NaN;if(n=ie.timezoneHHMM.exec(t),n){i=parseInt(n[1],10);var d=parseInt(n[2],10);return Te(i,d)?(r=Math.abs(i)*be+d*yt,i>0?-r:r):NaN}if(Tt(t)){a=new Date(a||Date.now());var u=s?a:Dt(a),h=oe(u,t),x=s?h:bt(a,h,t);return-x}return NaN}function Dt(t){return re(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds())}function oe(t,a){var s=mt(t,a),n=re(s[0],s[1]-1,s[2],s[3]%24,s[4],s[5],0).getTime(),r=t.getTime(),i=r%1e3;return r-=i>=0?i:1e3+i,n-r}function bt(t,a,s){var n=t.getTime(),r=n-a,i=oe(new Date(r),s);if(a===i)return a;r-=i-a;var d=oe(new Date(r),s);return i===d?i:Math.max(i,d)}function Te(t,a){return-23<=t&&t<=23&&(a==null||0<=a&&a<=59)}var Me={};function Tt(t){if(Me[t])return!0;try{return new Intl.DateTimeFormat(void 0,{timeZone:t}),Me[t]=!0,!0}catch{return!1}}var Mt=/(Z|[+-]\d{2}(?::?\d{2})?| UTC| [a-zA-Z]+\/[a-zA-Z_]+(?:\/[a-zA-Z_]+)?)$/;const Ce=Mt;var de=36e5,Ae=6e4,Ct=2,A={dateTimePattern:/^([0-9W+-]+)(T| )(.*)/,datePattern:/^([0-9W+-]+)(.*)/,plainTime:/:/,YY:/^(\d{2})$/,YYY:[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],YYYY:/^(\d{4})/,YYYYY:[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],MM:/^-(\d{2})$/,DDD:/^-?(\d{3})$/,MMDD:/^-?(\d{2})-?(\d{2})$/,Www:/^-?W(\d{2})$/,WwwD:/^-?W(\d{2})-?(\d{1})$/,HH:/^(\d{2}([.,]\d*)?)$/,HHMM:/^(\d{2}):?(\d{2}([.,]\d*)?)$/,HHMMSS:/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,timeZone:Ce};function ce(t,a){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");if(t===null)return new Date(NaN);var s=a||{},n=s.additionalDigits==null?Ct:ht(s.additionalDigits);if(n!==2&&n!==1&&n!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]")return new Date(t.getTime());if(typeof t=="number"||Object.prototype.toString.call(t)==="[object Number]")return new Date(t);if(!(typeof t=="string"||Object.prototype.toString.call(t)==="[object String]"))return new Date(NaN);var r=At(t),i=It(r.date,n),d=i.year,u=i.restDateString,h=Rt(u,d);if(isNaN(h))return new Date(NaN);if(h){var x=h.getTime(),M=0,c;if(r.time&&(M=Nt(r.time),isNaN(M)))return new Date(NaN);if(r.timeZone||s.timeZone){if(c=le(r.timeZone||s.timeZone,new Date(x+M)),isNaN(c))return new Date(NaN)}else c=De(new Date(x+M)),c=De(new Date(x+M+c));return new Date(x+M+c)}else return new Date(NaN)}function At(t){var a={},s=A.dateTimePattern.exec(t),n;if(s?(a.date=s[1],n=s[3]):(s=A.datePattern.exec(t),s?(a.date=s[1],n=s[2]):(a.date=null,n=t)),n){var r=A.timeZone.exec(n);r?(a.time=n.replace(r[1],""),a.timeZone=r[1].trim()):a.time=n}return a}function It(t,a){var s=A.YYY[a],n=A.YYYYY[a],r;if(r=A.YYYY.exec(t)||n.exec(t),r){var i=r[1];return{year:parseInt(i,10),restDateString:t.slice(i.length)}}if(r=A.YY.exec(t)||s.exec(t),r){var d=r[1];return{year:parseInt(d,10)*100,restDateString:t.slice(d.length)}}return{year:null}}function Rt(t,a){if(a===null)return null;var s,n,r,i;if(t.length===0)return n=new Date(0),n.setUTCFullYear(a),n;if(s=A.MM.exec(t),s)return n=new Date(0),r=parseInt(s[1],10)-1,Ne(a,r)?(n.setUTCFullYear(a,r),n):new Date(NaN);if(s=A.DDD.exec(t),s){n=new Date(0);var d=parseInt(s[1],10);return zt(a,d)?(n.setUTCFullYear(a,0,d),n):new Date(NaN)}if(s=A.MMDD.exec(t),s){n=new Date(0),r=parseInt(s[1],10)-1;var u=parseInt(s[2],10);return Ne(a,r,u)?(n.setUTCFullYear(a,r,u),n):new Date(NaN)}if(s=A.Www.exec(t),s)return i=parseInt(s[1],10)-1,Se(a,i)?Ie(a,i):new Date(NaN);if(s=A.WwwD.exec(t),s){i=parseInt(s[1],10)-1;var h=parseInt(s[2],10)-1;return Se(a,i,h)?Ie(a,i,h):new Date(NaN)}return null}function Nt(t){var a,s,n;if(a=A.HH.exec(t),a)return s=parseFloat(a[1].replace(",",".")),ue(s)?s%24*de:NaN;if(a=A.HHMM.exec(t),a)return s=parseInt(a[1],10),n=parseFloat(a[2].replace(",",".")),ue(s,n)?s%24*de+n*Ae:NaN;if(a=A.HHMMSS.exec(t),a){s=parseInt(a[1],10),n=parseInt(a[2],10);var r=parseFloat(a[3].replace(",","."));return ue(s,n,r)?s%24*de+n*Ae+r*1e3:NaN}return null}function Ie(t,a,s){a=a||0,s=s||0;var n=new Date(0);n.setUTCFullYear(t,0,4);var r=n.getUTCDay()||7,i=a*7+s+1-r;return n.setUTCDate(n.getUTCDate()+i),n}var St=[31,28,31,30,31,30,31,31,30,31,30,31],Et=[31,29,31,30,31,30,31,31,30,31,30,31];function Re(t){return t%400===0||t%4===0&&t%100!==0}function Ne(t,a,s){if(a<0||a>11)return!1;if(s!=null){if(s<1)return!1;var n=Re(t);if(n&&s>Et[a]||!n&&s>St[a])return!1}return!0}function zt(t,a){if(a<1)return!1;var s=Re(t);return!(s&&a>366||!s&&a>365)}function Se(t,a,s){return!(a<0||a>52||s!=null&&(s<0||s>6))}function ue(t,a,s){return!(t!=null&&(t<0||t>=25)||a!=null&&(a<0||a>=60)||s!=null&&(s<0||s>=60))}function Lt(t,a,s){if(typeof t=="string"&&!t.match(Ce)){var n=ft(s);return n.timeZone=a,ce(t,n)}var r=ce(t,s),i=re(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()).getTime(),d=le(a,new Date(i));return new Date(i+d)}function Ee(t,a,s){var n=ce(t,s),r=le(a,n,!0),i=new Date(n.getTime()-r),d=new Date(0);return d.setFullYear(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()),d.setHours(i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds(),i.getUTCMilliseconds()),d}var W=l(54894),Z=l(63891),Yt=l(50958),ge=l(61535),z=l(12083),ea=l(82437);const Pt=z.Ik().shape({name:z.Yj().trim().required(),scheduledAt:z.Yj().nullable(),isScheduled:z.zM().optional(),time:z.Yj().when("isScheduled",{is:!0,then:z.Yj().trim().required(),otherwise:z.Yj().nullable()}),timezone:z.Yj().when("isScheduled",{is:!0,then:z.Yj().required().nullable(),otherwise:z.Yj().nullable()}),date:z.Yj().when("isScheduled",{is:!0,then:z.Yj().required().nullable(),otherwise:z.Yj().nullable()})}).required().noUnknown(),ze=({handleClose:t,handleSubmit:a,initialValues:s,isLoading:n=!1})=>{const{formatMessage:r}=(0,W.A)(),{pathname:i}=(0,D.zy)(),d=i===`/plugins/${g.p}`,{timezoneList:u,systemTimezone:h={value:"UTC+00:00-Africa/Abidjan "}}=Le(s.scheduledAt?new Date(s.scheduledAt):new Date),x=c=>{const{date:C,time:I,timezone:p}=c;if(!C||!I||!p)return null;const b=p.split("&")[1];return Lt(`${C} ${I}`,b)},M=()=>u.find(C=>C.value.split("&")[1]===s.timezone)?.value||h.value;return(0,e.jsxs)(Ue.k,{onClose:t,labelledBy:"title",children:[(0,e.jsx)(He.r,{children:(0,e.jsx)(y.o,{id:"title",fontWeight:"bold",textColor:"neutral800",children:r({id:"content-releases.modal.title",defaultMessage:"{isCreatingRelease, select, true {New release} other {Edit release}}"},{isCreatingRelease:d})})}),(0,e.jsx)(ge.Formik,{onSubmit:c=>{a({...c,timezone:c.timezone?c.timezone.split("&")[1]:null,scheduledAt:c.isScheduled?x(c):null})},initialValues:{...s,timezone:s.timezone?M():h.value},validationSchema:Pt,validateOnChange:!1,children:({values:c,errors:C,handleChange:I,setFieldValue:p})=>(0,e.jsxs)(ge.Form,{children:[(0,e.jsx)(Be.c,{children:(0,e.jsxs)(v.s,{direction:"column",alignItems:"stretch",gap:6,children:[(0,e.jsx)(Fe.k,{label:r({id:"content-releases.modal.form.input.label.release-name",defaultMessage:"Name"}),name:"name",value:c.name,error:C.name,onChange:I,required:!0}),(0,e.jsx)(k.a,{width:"max-content",children:(0,e.jsx)(We.S,{name:"isScheduled",value:c.isScheduled,onChange:b=>{p("isScheduled",b.target.checked),b.target.checked?(p("date",s.date),p("time",s.time),p("timezone",s.timezone??h?.value)):(p("date",null),p("time",""),p("timezone",null))},children:(0,e.jsx)(y.o,{textColor:c.isScheduled?"primary600":"neutral800",fontWeight:c.isScheduled?"semiBold":"regular",children:r({id:"modal.form.input.label.schedule-release",defaultMessage:"Schedule release"})})})}),c.isScheduled&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(v.s,{gap:4,alignItems:"start",children:[(0,e.jsx)(k.a,{width:"100%",children:(0,e.jsx)(Ze.l,{label:r({id:"content-releases.modal.form.input.label.date",defaultMessage:"Date"}),name:"date",error:C.date,onChange:b=>{const L=b?(0,Yt.A)(b,{representation:"date"}):null;p("date",L)},clearLabel:r({id:"content-releases.modal.form.input.clearLabel",defaultMessage:"Clear"}),onClear:()=>{p("date",null)},selectedDate:c.date||void 0,required:!0,minDate:Ee(new Date,c.timezone.split("&")[1])})}),(0,e.jsx)(k.a,{width:"100%",children:(0,e.jsx)(Ge.A,{label:r({id:"content-releases.modal.form.input.label.time",defaultMessage:"Time"}),name:"time",error:C.time,onChange:b=>{p("time",b)},clearLabel:r({id:"content-releases.modal.form.input.clearLabel",defaultMessage:"Clear"}),onClear:()=>{p("time","")},value:c.time||void 0,required:!0})})]}),(0,e.jsx)(wt,{timezoneOptions:u})]})]})}),(0,e.jsx)(Qe.j,{startActions:(0,e.jsx)(J.$,{onClick:t,variant:"tertiary",name:"cancel",children:r({id:"cancel",defaultMessage:"Cancel"})}),endActions:(0,e.jsx)(J.$,{name:"submit",loading:n,type:"submit",children:r({id:"content-releases.modal.form.button.submit",defaultMessage:"{isCreatingRelease, select, true {Continue} other {Save}}"},{isCreatingRelease:d})})})]})})]})},Le=t=>{const a=Intl.supportedValuesOf("timeZone").map(n=>{const r=(0,g.g)(n,t);return{offset:r,value:`${r}&${n}`}}),s=a.find(n=>n.value.split("&")[1]===Intl.DateTimeFormat().resolvedOptions().timeZone);return{timezoneList:a,systemTimezone:s}},wt=({timezoneOptions:t})=>{const{values:a,errors:s,setFieldValue:n}=(0,ge.useFormikContext)(),{formatMessage:r}=(0,W.A)(),[i,d]=F.useState(t);return F.useEffect(()=>{if(a.date){const{timezoneList:u}=Le(new Date(a.date));d(u);const h=a.timezone&&u.find(x=>x.value.split("&")[1]===a.timezone.split("&")[1]);h&&n("timezone",h.value)}},[n,a.date,a.timezone]),(0,e.jsx)(Ke.G3,{label:r({id:"content-releases.modal.form.input.label.timezone",defaultMessage:"Timezone"}),autocomplete:{type:"list",filter:"contains"},name:"timezone",value:a.timezone||void 0,textValue:a.timezone?a.timezone.replace(/&/," "):void 0,onChange:u=>{n("timezone",u)},onTextValueChange:u=>{n("timezone",u)},onClear:()=>{n("timezone","")},error:s.timezone,required:!0,children:i.map(u=>(0,e.jsx)(Je.j,{value:u.value,children:u.value.replace(/&/," ")},u.value))})},Ot=(0,Z.default)(ve.N)`
  display: block;
`,$t=(0,Z.default)(o.RelativeTime)`
  display: inline-block;
  &::first-letter {
    text-transform: uppercase;
  }
`,Ye=t=>{let a;switch(t){case"ready":a="success";break;case"blocked":a="warning";break;case"failed":a="danger";break;case"done":a="primary";break;case"empty":default:a="neutral"}return{textColor:`${a}600`,backgroundColor:`${a}100`,borderColor:`${a}200`}},Pe=({sectionTitle:t,releases:a=[],isError:s=!1})=>{const{formatMessage:n}=(0,W.A)();return s?(0,e.jsx)(o.AnErrorOccurred,{}):a?.length===0?(0,e.jsx)(Xe.p,{content:n({id:"content-releases.page.Releases.tab.emptyEntries",defaultMessage:"No releases"},{target:t}),icon:(0,e.jsx)(it.A,{width:"10rem"})}):(0,e.jsx)(ke.x,{gap:4,children:a.map(({id:r,name:i,scheduledAt:d,status:u})=>(0,e.jsx)(Ve.E,{col:3,s:6,xs:12,children:(0,e.jsx)(Ot,{href:`content-releases/${r}`,isExternal:!1,children:(0,e.jsxs)(v.s,{direction:"column",justifyContent:"space-between",padding:4,hasRadius:!0,background:"neutral0",shadow:"tableShadow",height:"100%",width:"100%",alignItems:"start",gap:4,children:[(0,e.jsxs)(v.s,{direction:"column",alignItems:"start",gap:1,children:[(0,e.jsx)(y.o,{as:"h3",variant:"delta",fontWeight:"bold",children:i}),(0,e.jsx)(y.o,{variant:"pi",textColor:"neutral600",children:d?(0,e.jsx)($t,{timestamp:new Date(d)}):n({id:"content-releases.pages.Releases.not-scheduled",defaultMessage:"Not scheduled"})})]}),(0,e.jsx)(ee.E,{...Ye(u),children:u})]})})},r))})},Ut=(0,Z.default)(qe.F)`
  button {
    display: none;
  }
  p + div {
    margin-left: auto;
  }
`,Ht={name:"",date:null,time:"",isScheduled:!0,scheduledAt:null,timezone:null},Bt=()=>{const t=F.useRef(null),a=(0,D.zy)(),[s,n]=F.useState(!1),r=(0,o.useNotification)(),{formatMessage:i}=(0,W.A)(),{push:d,replace:u}=(0,D.W6)(),{formatAPIError:h}=(0,o.useAPIErrorHandler)(),[{query:x},M]=(0,o.useQueryParams)(),c=(0,g.u)(x),[C,{isLoading:I}]=(0,g.a)(),{getFeature:p}=(0,me.bO)(),{maximumReleases:b=3}=p("cms-content-releases"),{trackUsage:L}=(0,o.useTracking)(),{isLoading:w,isSuccess:U,isError:f}=c,H=c?.currentData?.meta?.activeTab||"pending",S=["pending","done"].indexOf(H);F.useEffect(()=>{a?.state?.errors&&(r({type:"warning",title:i({id:"content-releases.pages.Releases.notification.error.title",defaultMessage:"Your request could not be processed."}),message:i({id:"content-releases.pages.Releases.notification.error.message",defaultMessage:"Please try again or open another release."})}),u({state:null}))},[i,a?.state?.errors,u,r]),F.useEffect(()=>{t.current&&t.current._handlers.setSelectedTabIndex(S)},[S]);const B=()=>{n(P=>!P)};if(w)return(0,e.jsx)(V.g,{"aria-busy":w,children:(0,e.jsx)(o.LoadingIndicatorPage,{})});const Y=U&&c.currentData?.meta?.pendingReleasesCount||0,O=Y>=b,G=P=>{M({...x,page:1,pageSize:c?.currentData?.meta?.pagination?.pageSize||16,filters:{releasedAt:{$notNull:P!==0}}})},T=async({name:P,scheduledAt:m,timezone:R})=>{const N=await C({name:P,scheduledAt:m,timezone:R});"data"in N?(r({type:"success",message:i({id:"content-releases.modal.release-created-notification-success",defaultMessage:"Release created."})}),L("didCreateRelease"),d(`/plugins/content-releases/${N.data.data.id}`)):(0,g.i)(N.error)?r({type:"warning",message:h(N.error)}):r({type:"warning",message:i({id:"notification.error",defaultMessage:"An error occurred"})})};return(0,e.jsxs)(V.g,{"aria-busy":w,children:[(0,e.jsx)(pe.Q,{title:i({id:"content-releases.pages.Releases.title",defaultMessage:"Releases"}),subtitle:i({id:"content-releases.pages.Releases.header-subtitle",defaultMessage:"Create and manage content updates"}),primaryAction:(0,e.jsx)(o.CheckPermissions,{permissions:g.P.create,children:(0,e.jsx)(J.$,{startIcon:(0,e.jsx)(lt.A,{}),onClick:B,disabled:O,children:i({id:"content-releases.header.actions.add-release",defaultMessage:"New release"})})})}),(0,e.jsx)(Q.s,{children:(0,e.jsxs)(e.Fragment,{children:[O&&(0,e.jsx)(Ut,{marginBottom:6,action:(0,e.jsx)(ve.N,{href:"https://strapi.io/pricing-cloud",isExternal:!0,children:i({id:"content-releases.pages.Releases.max-limit-reached.action",defaultMessage:"Explore plans"})}),title:i({id:"content-releases.pages.Releases.max-limit-reached.title",defaultMessage:"You have reached the {number} pending {number, plural, one {release} other {releases}} limit."},{number:b}),onClose:()=>{},closeLabel:"",children:i({id:"content-releases.pages.Releases.max-limit-reached.message",defaultMessage:"Upgrade to manage an unlimited number of releases."})}),(0,e.jsxs)(_e.f,{label:i({id:"content-releases.pages.Releases.tab-group.label",defaultMessage:"Releases list"}),variant:"simple",initialSelectedTabIndex:S,onTabChange:G,ref:t,children:[(0,e.jsxs)(k.a,{paddingBottom:8,children:[(0,e.jsxs)(te.t,{children:[(0,e.jsx)(te.o,{children:i({id:"content-releases.pages.Releases.tab.pending",defaultMessage:"Pending ({count})"},{count:Y})}),(0,e.jsx)(te.o,{children:i({id:"content-releases.pages.Releases.tab.done",defaultMessage:"Done"})})]}),(0,e.jsx)(et.c,{})]}),(0,e.jsxs)(ae.T,{children:[(0,e.jsx)(ae.K,{children:(0,e.jsx)(Pe,{sectionTitle:"pending",releases:c?.currentData?.data,isError:f})}),(0,e.jsx)(ae.K,{children:(0,e.jsx)(Pe,{sectionTitle:"done",releases:c?.currentData?.data,isError:f})})]})]}),c.currentData?.meta?.pagination?.total?(0,e.jsxs)(v.s,{paddingTop:4,alignItems:"flex-end",justifyContent:"space-between",children:[(0,e.jsx)(o.PageSizeURLQuery,{options:["8","16","32","64"],defaultValue:c?.currentData?.meta?.pagination?.pageSize.toString()}),(0,e.jsx)(o.PaginationURLQuery,{pagination:{pageCount:c?.currentData?.meta?.pagination?.pageCount||0}})]}):null]})}),s&&(0,e.jsx)(ze,{handleClose:B,handleSubmit:T,isLoading:I,initialValues:Ht})]})},Ft=(0,Z.default)(v.s)`
  align-self: stretch;
  border-bottom-right-radius: ${({theme:t})=>t.borderRadius};
  border-bottom-left-radius: ${({theme:t})=>t.borderRadius};
  border-top: 1px solid ${({theme:t})=>t.colors.neutral150};
`,we=(0,Z.default)(q.q7)`
  svg path {
    fill: ${({theme:t,disabled:a})=>a&&t.colors.neutral500};
  }
  span {
    color: ${({theme:t,disabled:a})=>a&&t.colors.neutral500};
  }

  &:hover {
    background: ${({theme:t,variant:a="neutral"})=>t.colors[`${a}100`]};
  }
`,Wt=(0,Z.default)(ot.A)`
  width: ${({theme:t})=>t.spaces[3]};
  height: ${({theme:t})=>t.spaces[3]};
  path {
    fill: ${({theme:t})=>t.colors.neutral600};
  }
`,Zt=(0,Z.default)(dt.A)`
  width: ${({theme:t})=>t.spaces[3]};
  height: ${({theme:t})=>t.spaces[3]};
  path {
    fill: ${({theme:t})=>t.colors.danger600};
  }
`,Gt=(0,Z.default)(y.o)`
  max-width: 300px;
`,Qt=({action:t,schema:a,components:s,entry:n})=>{const{formatMessage:r}=(0,W.A)(),{validate:i}=(0,me.CQ)(),{errors:d}=i(n,{contentType:a,components:s,isCreatingEntry:!1});if(Object.keys(d).length>0){const u=Object.entries(d).map(([h,x])=>r({id:`${x.id}.withField`,defaultMessage:x.defaultMessage},{field:h})).join(" ");return(0,e.jsxs)(v.s,{gap:2,children:[(0,e.jsx)(se.I,{color:"danger600",as:ct.A}),(0,e.jsx)(tt.m,{description:u,children:(0,e.jsx)(Gt,{textColor:"danger600",variant:"omega",fontWeight:"semiBold",ellipsis:!0,children:u})})]})}return t=="publish"?(0,e.jsxs)(v.s,{gap:2,children:[(0,e.jsx)(se.I,{color:"success600",as:je.A}),n.publishedAt?(0,e.jsx)(y.o,{textColor:"success600",fontWeight:"bold",children:r({id:"content-releases.pages.ReleaseDetails.entry-validation.already-published",defaultMessage:"Already published"})}):(0,e.jsx)(y.o,{children:r({id:"content-releases.pages.ReleaseDetails.entry-validation.ready-to-publish",defaultMessage:"Ready to publish"})})]}):(0,e.jsxs)(v.s,{gap:2,children:[(0,e.jsx)(se.I,{color:"success600",as:je.A}),n.publishedAt?(0,e.jsx)(y.o,{children:r({id:"content-releases.pages.ReleaseDetails.entry-validation.ready-to-unpublish",defaultMessage:"Ready to unpublish"})}):(0,e.jsx)(y.o,{textColor:"success600",fontWeight:"bold",children:r({id:"content-releases.pages.ReleaseDetails.entry-validation.already-unpublished",defaultMessage:"Already unpublished"})})]})},Oe=({toggleEditReleaseModal:t,toggleWarningSubmit:a,children:s})=>{const{formatMessage:n,formatDate:r,formatTime:i}=(0,W.A)(),{releaseId:d}=(0,D.g)(),{data:u,isLoading:h,isError:x,error:M}=(0,g.b)({id:d}),[c,{isLoading:C}]=(0,g.e)(),I=(0,o.useNotification)(),{formatAPIError:p}=(0,o.useAPIErrorHandler)(),{allowedActions:{canUpdate:b,canDelete:L}}=(0,o.useRBAC)(g.P),w=(0,g.f)(),{trackUsage:U}=(0,o.useTracking)(),f=u?.data,H=async()=>{const m=await c({id:d});if("data"in m){I({type:"success",message:n({id:"content-releases.pages.ReleaseDetails.publish-notification-success",defaultMessage:"Release was published successfully."})});const{totalEntries:R,totalPublishedEntries:N,totalUnpublishedEntries:$}=m.data.meta;U("didPublishRelease",{totalEntries:R,totalPublishedEntries:N,totalUnpublishedEntries:$})}else(0,g.i)(m.error)?I({type:"warning",message:p(m.error)}):I({type:"warning",message:n({id:"notification.error",defaultMessage:"An error occurred"})})},S=()=>{w(g.r.util.invalidateTags([{type:"ReleaseAction",id:"LIST"},{type:"Release",id:d}]))},B=()=>f?.createdBy?f.createdBy.username?f.createdBy.username:f.createdBy.firstname?`${f.createdBy.firstname} ${f.createdBy.lastname||""}`.trim():f.createdBy.email:null;if(h)return(0,e.jsx)(V.g,{"aria-busy":h,children:(0,e.jsx)(o.LoadingIndicatorPage,{})});if(x||!f)return(0,e.jsx)(D.rd,{to:{pathname:"/plugins/content-releases",state:{errors:[{code:M?.code}]}}});const Y=f.actions.meta.count||0,O=Boolean(B()),G=f.scheduledAt&&f.timezone,T=n({id:"content-releases.pages.Details.header-subtitle",defaultMessage:"{number, plural, =0 {No entries} one {# entry} other {# entries}}"},{number:Y}),P=G?n({id:"content-releases.pages.ReleaseDetails.header-subtitle.scheduled",defaultMessage:"Scheduled for {date} at {time} ({offset})"},{date:r(new Date(f.scheduledAt),{weekday:"long",day:"numeric",month:"long",year:"numeric",timeZone:f.timezone}),time:i(new Date(f.scheduledAt),{timeZone:f.timezone,hourCycle:"h23"}),offset:(0,g.g)(f.timezone,new Date(f.scheduledAt))}):"";return(0,e.jsxs)(V.g,{"aria-busy":h,children:[(0,e.jsx)(pe.Q,{title:f.name,subtitle:(0,e.jsxs)(v.s,{gap:2,lineHeight:6,children:[(0,e.jsx)(y.o,{textColor:"neutral600",variant:"epsilon",children:T+(G?` - ${P}`:"")}),(0,e.jsx)(ee.E,{...Ye(f.status),children:f.status})]}),navigationAction:(0,e.jsx)(at.N,{startIcon:(0,e.jsx)(ut.A,{}),to:"/plugins/content-releases",children:n({id:"global.back",defaultMessage:"Back"})}),primaryAction:!f.releasedAt&&(0,e.jsxs)(v.s,{gap:2,children:[(0,e.jsxs)(q.bL,{children:[(0,e.jsx)(q.l9,{as:st.K,paddingLeft:2,paddingRight:2,"aria-label":n({id:"content-releases.header.actions.open-release-actions",defaultMessage:"Release edit and delete menu"}),icon:(0,e.jsx)(gt.A,{}),variant:"tertiary"}),(0,e.jsxs)(q.UC,{top:1,popoverPlacement:"bottom-end",children:[(0,e.jsxs)(v.s,{alignItems:"center",justifyContent:"center",direction:"column",padding:1,width:"100%",children:[(0,e.jsx)(we,{disabled:!b,onSelect:t,children:(0,e.jsxs)(v.s,{alignItems:"center",gap:2,hasRadius:!0,width:"100%",children:[(0,e.jsx)(Wt,{}),(0,e.jsx)(y.o,{ellipsis:!0,children:n({id:"content-releases.header.actions.edit",defaultMessage:"Edit"})})]})}),(0,e.jsx)(we,{disabled:!L,onSelect:a,variant:"danger",children:(0,e.jsxs)(v.s,{alignItems:"center",gap:2,hasRadius:!0,width:"100%",children:[(0,e.jsx)(Zt,{}),(0,e.jsx)(y.o,{ellipsis:!0,textColor:"danger600",children:n({id:"content-releases.header.actions.delete",defaultMessage:"Delete"})})]})})]}),(0,e.jsxs)(Ft,{direction:"column",justifyContent:"center",alignItems:"flex-start",gap:1,padding:5,children:[(0,e.jsx)(y.o,{variant:"pi",fontWeight:"bold",children:n({id:"content-releases.header.actions.created",defaultMessage:"Created"})}),(0,e.jsxs)(y.o,{variant:"pi",color:"neutral300",children:[(0,e.jsx)(o.RelativeTime,{timestamp:new Date(f.createdAt)}),n({id:"content-releases.header.actions.created.description",defaultMessage:"{hasCreatedByUser, select, true { by {createdBy}} other { by deleted user}}"},{createdBy:B(),hasCreatedByUser:O})]})]})]})]}),(0,e.jsx)(J.$,{size:"S",variant:"tertiary",onClick:S,children:n({id:"content-releases.header.actions.refresh",defaultMessage:"Refresh"})}),(0,e.jsx)(o.CheckPermissions,{permissions:g.P.publish,children:(0,e.jsx)(J.$,{size:"S",variant:"default",onClick:H,loading:C,disabled:f.actions.meta.count===0,children:n({id:"content-releases.header.actions.publish",defaultMessage:"Publish"})})})]})}),s]})},Kt=["contentType","locale","action"],Jt=["contentType","action"],$e=t=>t==="locale"?{id:"content-releases.pages.ReleaseDetails.groupBy.option.locales",defaultMessage:"Locales"}:t==="action"?{id:"content-releases.pages.ReleaseDetails.groupBy.option.actions",defaultMessage:"Actions"}:{id:"content-releases.pages.ReleaseDetails.groupBy.option.content-type",defaultMessage:"Content-Types"},Xt=[{key:"__name__",fieldSchema:{type:"string"},metadatas:{label:{id:"content-releases.page.ReleaseDetails.table.header.label.name",defaultMessage:"name"},searchable:!1,sortable:!1},name:"name"}],kt=()=>{const{formatMessage:t}=(0,W.A)(),{releaseId:a}=(0,D.g)(),[{query:s},n]=(0,o.useQueryParams)(),r=(0,o.useNotification)(),{formatAPIError:i}=(0,o.useAPIErrorHandler)(),{data:d,isLoading:u,isError:h,error:x}=(0,g.b)({id:a}),{allowedActions:{canUpdate:M}}=(0,o.useRBAC)(g.P),{runHookWaterfall:c}=(0,o.useStrapiApp)(),{displayedHeaders:C,hasI18nEnabled:I}=c("ContentReleases/pages/ReleaseDetails/add-locale-in-releases",{displayedHeaders:Xt,hasI18nEnabled:!1}),p=d?.data,b=s?.groupBy||"contentType",{isLoading:L,isFetching:w,isError:U,data:f,error:H}=(0,g.h)({...s,releaseId:a}),[S]=(0,g.j)(),B=async(m,R,N)=>{const $=await S({params:{releaseId:a,actionId:R},body:{type:m.target.value},query:s,actionPath:N});"error"in $&&((0,g.i)($.error)?r({type:"warning",message:i($.error)}):r({type:"warning",message:t({id:"notification.error",defaultMessage:"An error occurred"})}))};if(L||u)return(0,e.jsx)(Q.s,{children:(0,e.jsx)(o.LoadingIndicatorPage,{})});const Y=f?.data,O=f?.meta,G=O?.contentTypes||{},T=O?.components||{};if(h||!p){const m=[];return x&&m.push({code:x.code}),H&&m.push({code:H.code}),(0,e.jsx)(D.rd,{to:{pathname:"/plugins/content-releases",state:{errors:m}}})}if(U||!Y)return(0,e.jsx)(Q.s,{children:(0,e.jsx)(o.AnErrorOccurred,{})});if(Object.keys(Y).length===0)return(0,e.jsx)(Q.s,{children:(0,e.jsx)(o.NoContent,{content:{id:"content-releases.pages.Details.tab.emptyEntries",defaultMessage:"This release is empty. Open the Content Manager, select an entry and add it to the release."},action:(0,e.jsx)(rt.z,{as:_.Link,to:{pathname:"/content-manager"},style:{textDecoration:"none"},variant:"secondary",children:t({id:"content-releases.page.Details.button.openContentManager",defaultMessage:"Open the Content Manager"})})})});const P=I?Kt:Jt;return(0,e.jsx)(Q.s,{children:(0,e.jsxs)(v.s,{gap:8,direction:"column",alignItems:"stretch",children:[(0,e.jsx)(v.s,{children:(0,e.jsx)(xe.Z,{"aria-label":t({id:"content-releases.pages.ReleaseDetails.groupBy.aria-label",defaultMessage:"Group by"}),customizeContent:m=>t({id:"content-releases.pages.ReleaseDetails.groupBy.label",defaultMessage:"Group by {groupBy}"},{groupBy:m}),value:t($e(b)),onChange:m=>n({groupBy:m}),children:P.map(m=>(0,e.jsx)(xe.eY,{value:m,children:t($e(m))},m))})}),Object.keys(Y).map(m=>(0,e.jsxs)(v.s,{gap:4,direction:"column",alignItems:"stretch",children:[(0,e.jsx)(v.s,{role:"separator","aria-label":m,children:(0,e.jsx)(ee.E,{children:m})}),(0,e.jsx)(o.Table.Root,{rows:Y[m].map(R=>({...R,id:Number(R.entry.id)})),colCount:Y[m].length,isLoading:L,isFetching:w,children:(0,e.jsxs)(o.Table.Content,{children:[(0,e.jsxs)(o.Table.Head,{children:[C.map(({key:R,fieldSchema:N,metadatas:$,name:X})=>(0,e.jsx)(o.Table.HeaderCell,{fieldSchemaType:N.type,label:t($.label),name:X},R)),(0,e.jsx)(o.Table.HeaderCell,{fieldSchemaType:"string",label:t({id:"content-releases.page.ReleaseDetails.table.header.label.content-type",defaultMessage:"content-type"}),name:"content-type"}),(0,e.jsx)(o.Table.HeaderCell,{fieldSchemaType:"string",label:t({id:"content-releases.page.ReleaseDetails.table.header.label.action",defaultMessage:"action"}),name:"action"}),!p.releasedAt&&(0,e.jsx)(o.Table.HeaderCell,{fieldSchemaType:"string",label:t({id:"content-releases.page.ReleaseDetails.table.header.label.status",defaultMessage:"status"}),name:"status"})]}),(0,e.jsx)(o.Table.LoadingBody,{}),(0,e.jsx)(o.Table.Body,{children:Y[m].map(({id:R,contentType:N,locale:$,type:X,entry:fe},_t)=>(0,e.jsxs)(nt.Tr,{children:[(0,e.jsx)(K.Td,{width:"25%",maxWidth:"200px",children:(0,e.jsx)(y.o,{ellipsis:!0,children:`${N.mainFieldValue||fe.id}`})}),I&&(0,e.jsx)(K.Td,{width:"10%",children:(0,e.jsx)(y.o,{children:`${$?.name?$.name:"-"}`})}),(0,e.jsx)(K.Td,{width:"10%",children:(0,e.jsx)(y.o,{children:N.displayName||""})}),(0,e.jsx)(K.Td,{width:"20%",children:p.releasedAt?(0,e.jsx)(y.o,{children:t({id:"content-releases.page.ReleaseDetails.table.action-published",defaultMessage:"This entry was <b>{isPublish, select, true {published} other {unpublished}}</b>."},{isPublish:X==="publish",b:he=>(0,e.jsx)(y.o,{fontWeight:"bold",children:he})})}):(0,e.jsx)(g.R,{selected:X,handleChange:he=>B(he,R,[m,_t]),name:`release-action-${R}-type`,disabled:!M})}),!p.releasedAt&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(K.Td,{width:"20%",minWidth:"200px",children:(0,e.jsx)(Qt,{action:X,schema:G?.[N.uid],components:T,entry:fe})}),(0,e.jsx)(K.Td,{children:(0,e.jsx)(v.s,{justifyContent:"flex-end",children:(0,e.jsxs)(g.k.Root,{children:[(0,e.jsx)(g.k.ReleaseActionEntryLinkItem,{contentTypeUid:N.uid,entryId:fe.id,locale:$?.code}),(0,e.jsx)(g.k.DeleteReleaseActionItem,{releaseId:p.id,actionId:R})]})})})]})]},R))})]})})]},`releases-group-${m}`)),(0,e.jsxs)(v.s,{paddingTop:4,alignItems:"flex-end",justifyContent:"space-between",children:[(0,e.jsx)(o.PageSizeURLQuery,{defaultValue:O?.pagination?.pageSize.toString()}),(0,e.jsx)(o.PaginationURLQuery,{pagination:{pageCount:O?.pagination?.pageCount||0}})]})]})})},Vt=()=>{const{formatMessage:t}=(0,W.A)(),{releaseId:a}=(0,D.g)(),s=(0,o.useNotification)(),{formatAPIError:n}=(0,o.useAPIErrorHandler)(),{replace:r}=(0,D.W6)(),[i,d]=F.useState(!1),[u,h]=F.useState(!1),{isLoading:x,data:M,isSuccess:c}=(0,g.b)({id:a}),[C,{isLoading:I}]=(0,g.c)(),[p,{isLoading:b}]=(0,g.d)(),L=()=>{d(T=>!T)},w=()=>h(T=>!T);if(x)return(0,e.jsx)(Oe,{toggleEditReleaseModal:L,toggleWarningSubmit:w,children:(0,e.jsx)(Q.s,{children:(0,e.jsx)(o.LoadingIndicatorPage,{})})});const U=c&&M?.data||null,f=U?.name||"",H=U?.timezone??null,S=U?.scheduledAt&&H?Ee(U.scheduledAt,H):null,B=S?(0,ye.A)(S,"yyyy-MM-dd"):null,Y=S?(0,ye.A)(S,"HH:mm"):"",O=async T=>{const P=await C({id:a,name:T.name,scheduledAt:T.scheduledAt,timezone:T.timezone});"data"in P?(s({type:"success",message:t({id:"content-releases.modal.release-updated-notification-success",defaultMessage:"Release updated."})}),L()):(0,g.i)(P.error)?s({type:"warning",message:n(P.error)}):s({type:"warning",message:t({id:"notification.error",defaultMessage:"An error occurred"})})},G=async()=>{const T=await p({id:a});"data"in T?r("/plugins/content-releases"):(0,g.i)(T.error)?s({type:"warning",message:n(T.error)}):s({type:"warning",message:t({id:"notification.error",defaultMessage:"An error occurred"})})};return(0,e.jsxs)(Oe,{toggleEditReleaseModal:L,toggleWarningSubmit:w,children:[(0,e.jsx)(kt,{}),i&&(0,e.jsx)(ze,{handleClose:L,handleSubmit:O,isLoading:x||I,initialValues:{name:f||"",scheduledAt:S,date:B,time:Y,isScheduled:Boolean(S),timezone:H}}),(0,e.jsx)(o.ConfirmDialog,{bodyText:{id:"content-releases.dialog.confirmation-message",defaultMessage:"Are you sure you want to delete this release?"},isOpen:u,isConfirmButtonLoading:b,onToggleDialog:w,onConfirm:G})]})},qt=()=>(0,e.jsx)(o.CheckPagePermissions,{permissions:g.P.main,children:(0,e.jsxs)(D.dO,{children:[(0,e.jsx)(D.qh,{exact:!0,path:`/plugins/${g.p}`,component:Bt}),(0,e.jsx)(D.qh,{exact:!0,path:`/plugins/${g.p}/:releaseId`,component:Vt})]})})}}]);
