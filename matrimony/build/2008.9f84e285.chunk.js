"use strict";(self.webpackChunkmatrimony=self.webpackChunkmatrimony||[]).push([[2008],{82008:(Ae,X,s)=>{s.d(X,{ProtectedSettingsPage:()=>je});var e=s(92132),f=s(21272),b=s(11273),G=s(76517),Z=s(80782),T=s(61485),p=s(99248),m=s(85829),B=s(6239),I=s(12081),y=s(83997),x=s(12408),S=s(48653),K=s(94061),P=s(24093),W=s(67030),C=s(85963),R=s(90151),v=s(68074),U=s(7537),J=s(4181),N=s(48323),w=s(35513),k=s(26127),F=s(90361),M=s(33363),q=s(98765),ee=s(25641),$=s(88353),se=s(38413),te=s(55356),ae=s(4198),ne=s(53563),r=s(89167),V=s(54514),le=s(41909),ie=s(50612),z=s(5194),oe=s(36481),h=s(54894),j=s(61535),L=s(12083),de=s(60256),ce=s(82437),t=s(11245),re=s(74930),Te=s(2600),pe=s(5409),Be=s(51187),Ie=s(59080),Se=s(48940),Ke=s(35223);const ge=()=>{const[a,l]=f.useState(!1),d=(0,ce.wA)(),n=(0,r.useNotification)(),{post:c}=(0,r.useFetchClient)(),{formatAPIError:i}=(0,r.useAPIErrorHandler)();return{isAdding:a,addLocale:async g=>{l(!0);try{const{data:_}=await c("/i18n/locales",g);n({type:"success",message:{id:(0,t.g)("Settings.locales.modal.create.success")}}),d({type:t.A,newLocale:_})}catch(_){throw _ instanceof de.pe?n({type:"warning",message:i(_)}):n({type:"warning",message:{id:"notification.error"}}),_}finally{l(!1)}}}},Y=()=>{const{formatMessage:a}=(0,h.A)(),{notifyStatus:l}=(0,b.W)(),d=(0,r.useNotification)(),{get:n}=(0,r.useFetchClient)(),{isLoading:c,data:i}=(0,re.useQuery)(["plugin-i18n","locales"],async()=>{const{data:o}=await n("/i18n/iso-locales");if(Array.isArray(o))return o;throw new Error("The response is not an array.")},{onSuccess(){l(a({id:(0,t.g)("Settings.locales.modal.locales.loaded"),defaultMessage:"The locales have been successfully loaded."}))},onError(){d({type:"warning",message:{id:"notification.error"}})},initialData:[]});return{defaultLocales:i,isLoading:c}},_e=({value:a,onClear:l,onLocaleChange:d,error:n})=>{const{formatMessage:c}=(0,h.A)(),{defaultLocales:i=[],isLoading:o}=Y(),{locales:g}=(0,t.u)(),_=i.map(E=>({label:E.name,value:E.code})).filter(E=>{const u=g.find(({code:D})=>D===E.value);return!u||u.code===a}),A=a||"";return(0,e.jsx)(G.G3,{"aria-busy":o,error:n,label:c({id:(0,t.g)("Settings.locales.modal.locales.label"),defaultMessage:"Locales"}),value:A,onClear:l,onChange:E=>{const u=_.find(D=>D.value===E);u&&d({code:u.value,name:u.label})},placeholder:c({id:"components.placeholder.select",defaultMessage:"Select"}),children:_.map(E=>(0,e.jsx)(Z.j,{value:E.value,children:E.label},E.value))})},H=L.Ik().shape({code:L.Yj().required(),name:L.Yj().max(50,"Settings.locales.modal.locales.displayName.error").required(r.translatedErrors.required),isDefault:L.zM()}),Ee={code:"",name:"",isDefault:!1},me=({onClose:a})=>{const{isAdding:l,addLocale:d}=ge(),{formatMessage:n}=(0,h.A)(),{refetchPermissions:c}=(0,r.useRBACProvider)();return(0,e.jsx)(T.k,{onClose:a,labelledBy:"add-locale-title",children:(0,e.jsx)(j.Formik,{initialValues:Ee,onSubmit:async i=>{await d(i),await c()},validationSchema:H,validateOnChange:!1,children:(0,e.jsxs)(r.Form,{children:[(0,e.jsx)(p.r,{children:(0,e.jsx)(m.o,{fontWeight:"bold",textColor:"neutral800",as:"h2",id:"add-locale-title",children:n({id:(0,t.g)("Settings.list.actions.add"),defaultMessage:"Add new locale"})})}),(0,e.jsx)(B.c,{children:(0,e.jsxs)(I.f,{label:n({id:(0,t.g)("Settings.locales.modal.title"),defaultMessage:"Configurations"}),id:"tabs",variant:"simple",children:[(0,e.jsxs)(y.s,{justifyContent:"space-between",children:[(0,e.jsx)(m.o,{as:"h2",variant:"beta",children:n({id:(0,t.g)("Settings.locales.modal.title"),defaultMessage:"Configurations"})}),(0,e.jsxs)(x.t,{children:[(0,e.jsx)(x.o,{children:n({id:(0,t.g)("Settings.locales.modal.base"),defaultMessage:"Basic settings"})}),(0,e.jsx)(x.o,{children:n({id:(0,t.g)("Settings.locales.modal.advanced"),defaultMessage:"Advanced settings"})})]})]}),(0,e.jsx)(S.c,{}),(0,e.jsx)(K.a,{paddingTop:7,paddingBottom:7,children:(0,e.jsxs)(P.T,{children:[(0,e.jsx)(P.K,{children:(0,e.jsx)(he,{})}),(0,e.jsx)(P.K,{children:(0,e.jsx)(Q,{})})]})})]})}),(0,e.jsx)(W.j,{startActions:(0,e.jsx)(C.$,{variant:"tertiary",onClick:a,children:n({id:"app.components.Button.cancel",defaultMessage:"Cancel"})}),endActions:(0,e.jsx)(C.$,{type:"submit",startIcon:(0,e.jsx)(V.A,{}),disabled:l,children:n({id:"global.save",defaultMessage:"Save"})})})]})})})},he=()=>{const{formatMessage:a}=(0,h.A)(),{values:l,handleChange:d,setFieldValue:n,errors:c}=(0,j.useFormikContext)(),i=g=>{n("name",g.name),n("code",g.code)},o=()=>{n("displayName",""),n("code","")};return(0,e.jsxs)(R.x,{gap:4,children:[(0,e.jsx)(v.E,{col:6,children:(0,e.jsx)(_e,{error:c.code,value:l.code,onLocaleChange:i,onClear:o})}),(0,e.jsx)(v.E,{col:6,children:(0,e.jsx)(U.k,{name:"name",label:a({id:(0,t.g)("Settings.locales.modal.locales.displayName"),defaultMessage:"Locale display name"}),hint:a({id:(0,t.g)("Settings.locales.modal.locales.displayName.description"),defaultMessage:"Locale will be displayed under that name in the administration panel"}),error:c.name?a({id:(0,t.g)("Settings.locales.modal.locales.displayName.error"),defaultMessage:"The locale display name can only be less than 50 characters."}):void 0,value:l.name,onChange:d})})]})},Q=({isDefaultLocale:a})=>{const{values:l,setFieldValue:d}=(0,j.useFormikContext)(),{formatMessage:n}=(0,h.A)();return(0,e.jsx)(J.S,{name:"isDefault",hint:n({id:(0,t.g)("Settings.locales.modal.advanced.setAsDefault.hint"),defaultMessage:"One default locale is required, change it by selecting another one"}),onChange:()=>d("isDefault",!l.isDefault),value:l.isDefault,disabled:a,children:n({id:(0,t.g)("Settings.locales.modal.advanced.setAsDefault"),defaultMessage:"Set as default locale"})})},Me=()=>{const[a,l]=(0,f.useState)(!1),d=(0,t.a)(),n=(0,r.useNotification)(),{del:c}=(0,r.useFetchClient)();return{isDeleting:a,deleteLocale:async o=>{try{l(!0),await c(`/i18n/locales/${o}`),n({type:"success",message:{id:(0,t.g)("Settings.locales.modal.delete.success")}}),d({type:t.D,id:o})}catch{n({type:"warning",message:{id:"notification.error"}})}finally{l(!1)}}}},ue=({localeToDelete:a,onClose:l})=>{const{isDeleting:d,deleteLocale:n}=Me(),c=Boolean(a),i=()=>n(a.id).then(l);return(0,e.jsx)(r.ConfirmDialog,{isConfirmButtonLoading:d,onConfirm:i,onToggleDialog:l,isOpen:c})},De=()=>{const[a,l]=(0,f.useState)(!1),d=(0,t.a)(),n=(0,r.useNotification)(),{put:c}=(0,r.useFetchClient)();return{isEditing:a,editLocale:async(o,g)=>{try{l(!0);const{data:_}=await c(`/i18n/locales/${o}`,g);if("id"in _)n({type:"success",message:{id:(0,t.g)("Settings.locales.modal.edit.success")}}),d({type:t.U,editedLocale:_});else throw new Error("Invalid response")}catch{n({type:"warning",message:{id:"notification.error"}})}finally{l(!1)}}}},fe=({locale:a,onClose:l})=>{const{refetchPermissions:d}=(0,r.useRBACProvider)(),{isEditing:n,editLocale:c}=De(),{formatMessage:i}=(0,h.A)(),o=async({name:g,isDefault:_})=>{await c(a.id,{name:g,isDefault:_}),await d()};return(0,e.jsx)(T.k,{onClose:l,labelledBy:"edit-locale-title",children:(0,e.jsx)(j.Formik,{initialValues:{code:a.code??"",name:a.name??"",isDefault:Boolean(a.isDefault)},onSubmit:o,validationSchema:H,children:(0,e.jsxs)(r.Form,{children:[(0,e.jsx)(p.r,{children:(0,e.jsx)(m.o,{fontWeight:"bold",textColor:"neutral800",as:"h2",id:"edit-locale-title",children:i({id:(0,t.g)("Settings.list.actions.edit"),defaultMessage:"Edit a locale"})})}),(0,e.jsx)(B.c,{children:(0,e.jsxs)(I.f,{label:i({id:(0,t.g)("Settings.locales.modal.title"),defaultMessage:"Configurations"}),id:"tabs",variant:"simple",children:[(0,e.jsxs)(y.s,{justifyContent:"space-between",children:[(0,e.jsx)(m.o,{as:"h2",children:i({id:(0,t.g)("Settings.locales.modal.title"),defaultMessage:"Configurations"})}),(0,e.jsxs)(x.t,{children:[(0,e.jsx)(x.o,{children:i({id:(0,t.g)("Settings.locales.modal.base"),defaultMessage:"Basic settings"})}),(0,e.jsx)(x.o,{children:i({id:(0,t.g)("Settings.locales.modal.advanced"),defaultMessage:"Advanced settings"})})]})]}),(0,e.jsx)(S.c,{}),(0,e.jsx)(K.a,{paddingTop:7,paddingBottom:7,children:(0,e.jsxs)(P.T,{children:[(0,e.jsx)(P.K,{children:(0,e.jsx)(xe,{locale:a})}),(0,e.jsx)(P.K,{children:(0,e.jsx)(Q,{isDefaultLocale:Boolean(a&&a.isDefault)})})]})})]})}),(0,e.jsx)(W.j,{startActions:(0,e.jsx)(C.$,{variant:"tertiary",onClick:l,children:i({id:"app.components.Button.cancel",defaultMessage:"Cancel"})}),endActions:(0,e.jsx)(C.$,{type:"submit",startIcon:(0,e.jsx)(V.A,{}),disabled:n,children:i({id:"global.save",defaultMessage:"Save"})})})]})})})},xe=({locale:a})=>{const{formatMessage:l}=(0,h.A)(),{values:d,handleChange:n,errors:c}=(0,j.useFormikContext)(),{defaultLocales:i=[]}=Y(),o=i.find(g=>g.code===a.code);return(0,e.jsxs)(R.x,{gap:4,children:[(0,e.jsx)(v.E,{col:6,children:(0,e.jsx)(N.Z,{label:l({id:(0,t.g)("Settings.locales.modal.locales.label"),defaultMessage:"Locales"}),value:o?.code||a.code,disabled:!0,children:(0,e.jsx)(N.eY,{value:o?.code||a.code,children:o?.name||a.code})})}),(0,e.jsx)(v.E,{col:6,children:(0,e.jsx)(U.k,{name:"name",label:l({id:(0,t.g)("Settings.locales.modal.locales.displayName"),defaultMessage:"Locale display name"}),hint:l({id:(0,t.g)("Settings.locales.modal.locales.displayName.description"),defaultMessage:"Locale will be displayed under that name in the administration panel"}),error:c.name?l({id:(0,t.g)("Settings.locales.modal.locales.displayName.error"),defaultMessage:"The locale display name can only be less than 50 characters."}):void 0,value:d.name,onChange:n})})]})},Pe=({locales:a=[],onDeleteLocale:l,onEditLocale:d,canDelete:n=!0,canEdit:c=!0})=>{const{formatMessage:i}=(0,h.A)();return(0,e.jsxs)(w.X,{colCount:4,rowCount:a.length+1,children:[(0,e.jsx)(k.d,{children:(0,e.jsxs)(F.Tr,{children:[(0,e.jsx)(M.Th,{children:(0,e.jsx)(m.o,{variant:"sigma",textColor:"neutral600",children:i({id:(0,t.g)("Settings.locales.row.id"),defaultMessage:"ID"})})}),(0,e.jsx)(M.Th,{children:(0,e.jsx)(m.o,{variant:"sigma",textColor:"neutral600",children:i({id:(0,t.g)("Settings.locales.row.displayName"),defaultMessage:"Display name"})})}),(0,e.jsx)(M.Th,{children:(0,e.jsx)(m.o,{variant:"sigma",textColor:"neutral600",children:i({id:(0,t.g)("Settings.locales.row.default-locale"),defaultMessage:"Default locale"})})}),(0,e.jsx)(M.Th,{children:(0,e.jsx)(q.s,{children:"Actions"})})]})}),(0,e.jsx)(ee.N,{children:a.map(o=>(0,e.jsxs)(F.Tr,{...(0,r.onRowClick)({fn:()=>d(o),condition:Boolean(d)}),children:[(0,e.jsx)(M.Td,{children:(0,e.jsx)(m.o,{textColor:"neutral800",children:o.id})}),(0,e.jsx)(M.Td,{children:(0,e.jsx)(m.o,{textColor:"neutral800",children:o.name})}),(0,e.jsx)(M.Td,{children:(0,e.jsx)(m.o,{textColor:"neutral800",children:o.isDefault?i({id:(0,t.g)("Settings.locales.default"),defaultMessage:"Default"}):null})}),(0,e.jsx)(M.Td,{children:(0,e.jsxs)(y.s,{gap:1,justifyContent:"flex-end",onClick:g=>g.stopPropagation(),children:[c&&(0,e.jsx)($.K,{onClick:()=>d(o),label:i({id:(0,t.g)("Settings.list.actions.edit"),defaultMessage:"Edit"}),icon:(0,e.jsx)(le.A,{}),borderWidth:0}),n&&!o.isDefault&&(0,e.jsx)($.K,{onClick:()=>l(o),label:i({id:(0,t.g)("Settings.list.actions.delete"),defaultMessage:"Delete"}),icon:(0,e.jsx)(ie.A,{}),borderWidth:0})]})})]},o.id))})]})},Ce=()=>{const[a,l]=f.useState(!1),[d,n]=f.useState(),[c,i]=f.useState(),{locales:o}=(0,t.u)(),{formatMessage:g}=(0,h.A)(),{isLoading:_,allowedActions:{canUpdate:A,canCreate:E,canDelete:u}}=(0,r.useRBAC)(t.P),D=()=>{l(O=>!O)};(0,r.useFocusWhenNavigate)();const Oe=()=>n(void 0),ve=O=>{n(O)},Le=()=>i(void 0),ye=O=>{i(O)};return _?(0,e.jsx)(r.LoadingIndicatorPage,{}):(0,e.jsxs)(se.g,{tabIndex:-1,children:[(0,e.jsx)(te.Q,{primaryAction:(0,e.jsx)(C.$,{disabled:!E,startIcon:(0,e.jsx)(z.A,{}),onClick:D,size:"S",children:g({id:(0,t.g)("Settings.list.actions.add"),defaultMessage:"Add new locale"})}),title:g({id:(0,t.g)("plugin.name"),defaultMessage:"Internationalization"}),subtitle:g({id:(0,t.g)("Settings.list.description"),defaultMessage:"Configure the settings"})}),(0,e.jsx)(ae.s,{children:o?.length>0?(0,e.jsx)(Pe,{locales:o,canDelete:u,canEdit:A,onDeleteLocale:ve,onEditLocale:ye}):(0,e.jsx)(ne.p,{icon:(0,e.jsx)(oe.A,{width:void 0,height:void 0}),content:g({id:(0,t.g)("Settings.list.empty.title"),defaultMessage:"There are no locales"}),action:(0,e.jsx)(C.$,{disabled:!E,variant:"secondary",startIcon:(0,e.jsx)(z.A,{}),onClick:D,children:g({id:(0,t.g)("Settings.list.actions.add"),defaultMessage:"Add new locale"})})})}),a&&(0,e.jsx)(me,{onClose:D}),c&&(0,e.jsx)(fe,{onClose:Le,locale:c}),d&&(0,e.jsx)(ue,{localeToDelete:d,onClose:Oe})]})},je=()=>(0,e.jsx)(r.CheckPagePermissions,{permissions:t.P.read,children:(0,e.jsx)(Ce,{})})}}]);
